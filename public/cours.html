<!DOCTYPE html>
<html>
    <head>
        <title>Note ton prof</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    </head>
    <body>
        <div id="App" class="container">
            <v-row class="fill-height">
                    <v-col>
                        <v-sheet height="64">
                        <v-toolbar
                            flat
                        >
                            <v-btn
                                outlined
                                class="mr-4"
                                color="grey darken-2"
                                @click="setToday"
                            >Aujourd'hui</v-btn>
                            <v-btn
                                fab
                                text
                                small
                                color="grey darken-2"
                                @click="prev"
                            >
                                <v-icon small>
                                    mdi-chevron-left
                                </v-icon>
                            </v-btn>
                            <v-btn
                                fab
                                text
                                small
                                color="grey darken-2"
                                @click="next"
                            >
                                <v-icon small>
                                    mdi-chevron-right
                                </v-icon>
                            </v-btn>
                            <v-toolbar-title v-if="$refs.calendar">
                                {{ $refs.calendar.title }}
                            </v-toolbar-title>
                            <v-spacer></v-spacer>
                            <v-menu
                                bottom
                                right
                            >
                                <template v-slot:activator="{ on, attrs }">
                                    <v-btn
                                    outlined
                                    color="grey darken-2"
                                    v-bind="attrs"
                                    v-on="on"
                                    >
                                    <span>{{ typeSelected.name }}</span>
                                    <v-icon right>
                                        mdi-menu-down
                                    </v-icon>
                                    </v-btn>
                                </template>
                                <v-list>
                                    <v-list-item v-for="type in types" :key="type.key" @click="typeSelected = type">
                                        <v-list-item-title>{{ type.name }}</v-list-item-title>
                                    </v-list-item>
                                </v-list>
                            </v-menu>
                        </v-toolbar>
                        </v-sheet>
                        <v-sheet height="600">
                        <v-calendar
                            ref="calendar"
                            v-model="focus"
                            color="primary"
                            :events="events"
                            :event-color="getEventColor"
                            :type="typeSelected.key"
                            @click:event="showEvent"
                            @click:more="viewDay"
                            @click:date="viewDay"
                            @change="updateRange"
                        ></v-calendar>
                        <v-menu
                            v-model="selectedOpen"
                            :close-on-content-click="false"
                            :activator="selectedElement"
                            offset-x
                        >
                            <v-card
                                color="grey lighten-4"
                                min-width="350px"
                                flat
                            >
                            <v-toolbar :color="selectedEvent.color" dark>
                                <v-btn icon><v-icon>mdi-pencil</v-icon></v-btn>
                                <v-toolbar-title v-html="selectedEvent.name"></v-toolbar-title>
                                <v-spacer></v-spacer>
                                <v-btn icon><v-icon>mdi-heart</v-icon></v-btn>
                                <v-btn icon><v-icon>mdi-dots-vertical</v-icon></v-btn>
                            </v-toolbar>

                            <v-card-text><span v-html="selectedEvent.details"></span></v-card-text>

                            <v-card-actions>
                                <v-btn
                                text
                                color="secondary"
                                @click="selectedOpen = false"
                                >Annuler</v-btn>
                            </v-card-actions>
                            </v-card>
                        </v-menu>
                        </v-sheet>
                    </v-col>
                    </v-row>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>        
        <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>

        <script>
            var app = new Vue({
                el:"#App",
                vuetify: new Vuetify(),
                
                data:{
                    focus: "",
                    typeSelected: { key: "day", name: "Jour" },
                    types: [
                        { key: "day", name: "Jour" },
                        { key: "week", name: "Semaine" },
                        { key: "month", name: "Mois" },
                    ],
                    selectedEvent: {},
                    selectedElement: null,
                    selectedOpen: false,
                    events: [],
                    colors: ['blue', 'indigo', 'deep-purple', 'cyan', 'green', 'orange', 'grey darken-1'],
                    names: [],
                },

                mounted(){
                    this.$refs.calendar.checkChange()
                },
                methods:{
                    // Vuetify
                    viewDay ({ date }) {
                        this.focus = date
                        this.type = 'day'
                    },
                    getEventColor (event) {
                        return event.color
                    },
                    setToday () {
                        this.focus = ''
                    },
                    prev () {
                        this.$refs.calendar.prev()
                    },
                    next () {
                        this.$refs.calendar.next()
                    },
                    showEvent ({ nativeEvent, event }) {
                        const open = () => {
                        this.selectedEvent = event
                        this.selectedElement = nativeEvent.target
                        setTimeout(() => {
                            this.selectedOpen = true
                        }, 10)
                        }

                        if (this.selectedOpen) {
                        this.selectedOpen = false
                        setTimeout(open, 10)
                        } else {
                        open()
                        }

                        nativeEvent.stopPropagation()
                    },
                    updateRange ({ start, end }) {
                        const events = []

                        const min = new Date(`${start.date}T00:00:00`)
                        const max = new Date(`${end.date}T23:59:59`)
                        const days = (max.getTime() - min.getTime()) / 86400000
                        const eventCount = this.rnd(days, days + 20)

                        for (let i = 0; i < eventCount; i++) {
                        const allDay = this.rnd(0, 3) === 0
                        const firstTimestamp = this.rnd(min.getTime(), max.getTime())
                        const first = new Date(firstTimestamp - (firstTimestamp % 900000))
                        const secondTimestamp = this.rnd(2, allDay ? 288 : 8) * 900000
                        const second = new Date(first.getTime() + secondTimestamp)

                        events.push({
                            name: this.names[this.rnd(0, this.names.length - 1)],
                            start: first,
                            end: second,
                            color: this.colors[this.rnd(0, this.colors.length - 1)],
                            timed: !allDay,
                        })
                        }

                        this.events = events
                    },
                    rnd (a, b) {
                        return Math.floor((b - a + 1) * Math.random()) + a
                    },
                },
            });
        </script>
    </body>
</html>